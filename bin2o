#!/bin/bash

header_name=$4

if (( $# != 4 ))
then
	printf "Usage: $0 <infile> <outfile> <array name> <header name>\n"
	exit 1
fi

# Create the object file
bin2c $1 "bin2o_intermediate_file.c" $3
gcc -c -Wall -Wextra bin2o_intermediate_file.c -o $2
rm "bin2o_intermediate_file.c"

# Create the header
touch "$4"
printf "#ifndef BIN2O_${header_name/"."/"_"}_H_INCLUDED\n"		>> $4
printf "#define BIN2O_${header_name/"."/"_"}_H_INCLUDED\n\n"	>> $4
printf "/* Generated by bin2o from file ${1} */\n\n"			>> $4
printf "extern const unsigned long ${3}_size;\n"				>> $4
printf "extern const unsigned char ${3}[];\n\n"					>> $4
printf "#endif\n"												>> $4

exit 0
